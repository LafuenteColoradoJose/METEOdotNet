@using System.Net.Http.Json
@inject HttpClient Http
@inject IJSRuntime JSRuntime

@code {
    private WeatherData? weatherData;
    private double Latitude = 51.5074;
    private double Longitude = -0.09;


    private DateTime time = DateTime.Now;
    private TimeZoneInfo timeZone = TimeZoneInfo.Local;

    protected override async Task OnInitializedAsync()
    {
        await LoadWeatherData();
    }

    private async Task LoadWeatherData()
    {
        var url = "https://api.open-meteo.com/v1/forecast?latitude=51.5074&longitude=-0.09&hourly=temperature_2m,precipitation,cloud_cover,wind_speed_10m,wind_direction_10m&timezone=Europe%2FLondon&forecast_days=1&models=icon_seamless";
        weatherData = await Http.GetFromJsonAsync<WeatherData>(url);
        // Console.WriteLine("Weather Data: " + weatherData);

        StateHasChanged();
    }


    // private string GetWeatherIcon()
    // {
    //     if (weatherData == null || weatherData.hourly == null)
    //     {
    //         return "icons/9027124_spinner_thin_icon.svg"; // Generic spinner icon
    //     }

    //     var temperature = weatherData.hourly.temperature_2m?.FirstOrDefault() ?? 0;
    //     var cloudCover = weatherData.hourly.cloud_cover?.FirstOrDefault() ?? 0;
    //     var precipitation = weatherData.hourly.precipitation?.FirstOrDefault() ?? 0;
    //     var windSpeed = weatherData.hourly.wind_speed_10m?.FirstOrDefault() ?? 0;
    //     var isDay = weatherData.hourly.is_day?.FirstOrDefault() ?? false;

    //     if (isDay && cloudCover < 10 && precipitation < 1)
    //     {
    //         return "icons/3741356_sun_sunny_weather_icon.svg";
    //     }
    //     else if (!isDay && cloudCover < 10 && precipitation < 1)
    //     {
    //         return "icons/3741364_clearly_night_night_star_weather_icon.svg";
    //     }
    //     else if (cloudCover > 10 && precipitation < 1)
    //     {
    //         return "icons/3741359_cloud_overcast_weather_icon.svg";
    //     }
    //     else
    //     {
    //         return "icons/3741348_heavy_rain_rain_weather_icon.svg"; // Default icon
    //     }
    // }

    public class WeatherData
    {
        public Hourly hourly { get; set; } = new Hourly();
    }

    public class Hourly
    {
        public List<double>? temperature_2m { get; set; }
        public List<double> precipitation { get; set; } = new List<double>();
        public List<double>? cloud_cover { get; set; } = new List<double>();
        public List<double>? wind_speed_10m { get; set; }
        public List<double>? wind_direction_10m { get; set; }
        public List<bool>? is_day { get; set; }
    }
}

<section id="cardWeater" class="mt-1">
   @*  <h3>Weather Dashboard</h3>

    <p>latitude</p>
    <p>@Latitude</p>
    <p>longitude</p>
    <p>@Longitude</p> *@

    @if (weatherData == null)
    {
        <p>Loading...</p>
    }
    else
    {
        <article class="d-flex align-items-center justify-content-center rounded">
            <div class="d-flex flex-column bg-light rounded p-4 w-100 max-w-xs">
                <div class="font-weight-bold h4">Current Location</div>
                <div class="text-muted small">@time.ToString("dddd dd MMMM yyyy")</div>
                <div class="mt-6 display-1 d-flex align-items-center justify-content-center rounded-lg text-primary h-24 w-24">
                    @* <img src="@GetWeatherIcon()" alt="Weather Icon" class="w-32 h-32" /> *@
                </div>
                <div class="d-flex align-items-center justify-content-center mt-6">
                    <div class="font-weight-medium display-1">@((weatherData?.hourly?.temperature_2m?.FirstOrDefault() ?? 0).ToString("0"))°</div>
                </div>
                <div class="d-flex justify-content-between mt-6">
                    <div class="d-flex flex-column align-items-center">
                        <div class="font-weight-medium small">Wind</div>
                        <div class="text-muted small">@((weatherData?.hourly?.wind_speed_10m?.FirstOrDefault() ?? 0).ToString("0")) m/s</div>
                    </div>
                    <div class="d-flex flex-column align-items-center">
                        <div class="font-weight-medium small">Direction</div>
                        <div class="text-muted small">@((weatherData?.hourly?.wind_direction_10m?.FirstOrDefault() ?? 0).ToString("0"))°</div>
                    </div>
                    <div class="d-flex flex-column align-items-center">
                        <div class="font-weight-medium small">Precipitation</div>
                        <div class="text-muted small">@((weatherData?.hourly?.precipitation?.FirstOrDefault() ?? 0).ToString("0")) mm</div>
                    </div>
                    <div class="d-flex flex-column align-items-center">
                        <div class="font-weight-medium small">Cloud Cover</div>
                        <div class="text-muted small">@((weatherData?.hourly?.cloud_cover?.FirstOrDefault() ?? 0).ToString("0")) %</div>
                    </div>
                </div>
            </div>
        </article>

       
    }
</section>